---
import BaseLayout from "../layouts/BaseLayout.astro";
import { profiles } from "../data/profile-i18n";

const profile = profiles.en;
const taglineParts = profile.hero.tagline.split(". ");
const taglinePrimary = taglineParts[0]?.trim() ?? "";
const taglineSecondary = taglineParts.slice(1).join(". ").trim();
const hasSimulation = (name: string) =>
  name.includes("RAFT") ||
  name.includes("Raft") ||
  name.includes("Kademlia") ||
  name.includes("Hash Table") ||
  name.includes("Distributed") ||
  name.includes("Redis");
const isRaft = (name: string) => name.includes("RAFT") || name.includes("Raft");
const isKademlia = (name: string) =>
  name.includes("Hash Table") || name.includes("Distributed") || name.includes("Kademlia");
const isRedis = (name: string) => name.includes("Redis");
const metaTitle = `${profile.hero.name} ‚Äî Portfolio`;
const metaDescription = profile.hero.tagline;
const structuredData = JSON.stringify({
  "@context": "https://schema.org",
  "@type": "Person",
  name: profile.hero.name,
  jobTitle: profile.hero.title,
  url: "https://r14dd.github.io",
  sameAs: [profile.links.linkedin, profile.links.github],
  email: "mailto:riadmukh@gmail.com",
});
---

<BaseLayout
  introLead={profile.labels.introLead}
  introName={profile.hero.name}
  metaTitle={metaTitle}
  metaDescription={metaDescription}
  structuredData={structuredData}
  lang="en"
>
  <div class="scroll-rail">
    <div class="scroll-progress" id="scroll-progress"></div>
  </div>

  <script type="application/json" id="i18n-data" set:html={JSON.stringify(profiles)}></script>

  <div class="lang-switcher" aria-label="Language">
    <button class="lang-toggle" id="lang-toggle" type="button" aria-haspopup="listbox" aria-expanded="false">
      <span class="lang-globe" aria-hidden="true">üåê</span>
      <span class="lang-label" id="lang-current">English</span>
      <span class="lang-caret" aria-hidden="true">‚ñæ</span>
    </button>
    <div class="lang-menu" id="lang-menu" role="listbox" aria-label="Select language">
      <button type="button" data-lang="en">English</button>
      <button type="button" data-lang="ru">–†—É—Å—Å–∫–∏–π</button>
      <button type="button" data-lang="az">Az…ôrbaycanca</button>
      <button type="button" data-lang="es">Espa√±ol</button>
    </div>
  </div>

  <div class="mobile-bar">
    <button class="hamburger" type="button" aria-label="Open menu">
      <span></span>
      <span></span>
      <span></span>
    </button>
    <div class="mobile-current" aria-live="polite">{profile.labels.nav.education}</div>
  </div>
  <div class="mobile-menu" aria-hidden="true">
    <a href="#education">{profile.labels.nav.education}</a>
    <a href="#experience">{profile.labels.nav.experience}</a>
    <a href="#projects">{profile.labels.nav.projects}</a>
    <a href="#teaching">{profile.labels.nav.teaching}</a>
    <a href="#skills">{profile.labels.nav.skills}</a>
    <a href="#reading">{profile.labels.nav.reading}</a>
    <a href="#connect">{profile.labels.nav.connect}</a>
  </div>

  <aside class="side-nav">
    <a href="#education">{profile.labels.nav.education}</a>
    <a href="#experience">{profile.labels.nav.experience}</a>
    <a href="#projects">{profile.labels.nav.projects}</a>
    <a href="#teaching">{profile.labels.nav.teaching}</a>
    <a href="#skills">{profile.labels.nav.skills}</a>
    <a href="#reading">{profile.labels.nav.reading}</a>
    <a href="#connect">{profile.labels.nav.connect}</a>
  </aside>

  <aside class="side-links">
    <span class="mono">Links</span>
    <div class="resume-hover">
      <a href={profile.links.resume} target="_blank" rel="noopener">{profile.labels.links.resume}</a>
      <div class="resume-preview" aria-hidden="true">
        <iframe title="Resume preview" src="/resume.pdf#page=1&zoom=page-width"></iframe>
      </div>
    </div>
    <a href={profile.links.linkedin} target="_blank" rel="noopener">{profile.labels.links.linkedin}</a>
    <a href={profile.links.github} target="_blank" rel="noopener">{profile.labels.links.github}</a>
  </aside>

  <main class="content">
    <section>
      <h1>{profile.hero.name}</h1>
      <p class="hero-tagline">{taglinePrimary}{taglinePrimary.endsWith(".") ? "" : "."}</p>
      {taglineSecondary && (
        <p class="hero-tagline secondary">{taglineSecondary}</p>
      )}
      <div class="hero-cta">
        <a
          class="cta-btn"
          href={profile.links.resume}
          target="_blank"
          rel="noopener"
          download
        >
          <svg class="cta-icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 4v10m0 0l-4-4m4 4l4-4M5 20h14" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>
          {profile.labels.links.resume}
        </a>
      </div>
      <div class="hero-links">
        <a href={profile.links.resume} target="_blank" rel="noopener">{profile.labels.links.resume}</a>
        <a href={profile.links.linkedin} target="_blank" rel="noopener">{profile.labels.links.linkedin}</a>
        <a href={profile.links.github} target="_blank" rel="noopener">{profile.labels.links.github}</a>
      </div>
    </section>

    <section id="education" class="section-block" data-label={profile.labels.headings.education}>
      <h2>{profile.labels.headings.education}</h2>
      <div class="meta-card">
        <h3>State University of New York at Buffalo ‚Äî BS in Computer Science</h3>
        <div class="tech-meta">Aug 2020 ‚Äì May 2024 ¬∑ Buffalo, New York</div>
        <ul>
          <li>Awards: Undergraduate Teaching Assistant Award, Multiple Dean's List Honors</li>
        </ul>
      </div>
    </section>

    <section id="experience" class="section-block" data-label={profile.labels.headings.experience}>
      <h2>{profile.labels.headings.experience}</h2>
      {profile.experience.map((exp) => (
        <div class="project-card">
          <h3 class="job-title">{exp.role}</h3>
          <div class="experience-stack">
            <span class="company-name">{exp.org}</span>
            <small class="exp-meta">{exp.period}</small>
            <small class="exp-meta">{exp.location}</small>
          </div>
          <ul>
            {exp.bullets.map((b) => <li>{b}</li>)}
          </ul>
        </div>
      ))}
    </section>

    <section id="projects" class="section-block" data-label={profile.labels.headings.projects}>
      <h2>{profile.labels.headings.projects}</h2>
      {profile.projects.map((p) => (
        <div class="project-card">
          <div class="project-header">
            <div>
              <h3>{p.name}</h3>
              <div class="project-tech">{p.tech.join(" ¬∑ ")}</div>
            </div>
            <div class="project-actions">
              {/* Simulate only for Raft and DHT */}
              {p.links?.github && <a class="project-link" href={p.links.github} target="_blank" rel="noopener">GitHub</a>}
              {hasSimulation(p.name) && (
                <button class="simulate-btn" type="button">Simulate</button>
              )}
            </div>
          </div>
          {p.impact && <div class="project-impact"><strong>Impact:</strong> {p.impact.replace(/^(?:Impact:\s*)+/i, "")}</div>}
          <ul class="project-bullets">
            {p.bullets.map((b) => <li>{b}</li>)}
          </ul>
          {isRaft(p.name) && (
            <div class="sim-visual" data-sim="raft">
              <svg width="260" height="80" viewBox="0 0 260 80">
                <line class="sim-link" x1="30" y1="40" x2="130" y2="15" />
                <line class="sim-link" x1="30" y1="40" x2="130" y2="65" />
                <line class="sim-link" x1="230" y1="40" x2="130" y2="15" />
                <line class="sim-link" x1="230" y1="40" x2="130" y2="65" />
                <circle class="sim-node" cx="30" cy="40" r="10" />
                <circle class="sim-node" cx="130" cy="15" r="10" />
                <circle class="sim-node" cx="130" cy="65" r="10" />
                <circle class="sim-node" cx="230" cy="40" r="10" />
                <circle class="sim-pulse" cx="30" cy="40" r="3">
                  <animate attributeName="cx" values="30;130;230;130;30" dur="3s" repeatCount="indefinite" />
                  <animate attributeName="cy" values="40;15;40;65;40" dur="3s" repeatCount="indefinite" />
                </circle>
              </svg>
            </div>
          )}
          {isKademlia(p.name) && (
            <div class="sim-visual" data-sim="kademlia">
              <svg width="260" height="80" viewBox="0 0 260 80">
                <line class="sim-link" x1="40" y1="20" x2="120" y2="40" />
                <line class="sim-link" x1="120" y1="40" x2="200" y2="20" />
                <line class="sim-link" x1="120" y1="40" x2="200" y2="65" />
                <circle class="sim-node" cx="40" cy="20" r="10" />
                <circle class="sim-node" cx="120" cy="40" r="10" />
                <circle class="sim-node" cx="200" cy="20" r="10" />
                <circle class="sim-node" cx="200" cy="65" r="10" />
                <circle class="sim-pulse" cx="40" cy="20" r="3">
                  <animate attributeName="cx" values="40;120;200;120;40" dur="2.6s" repeatCount="indefinite" />
                  <animate attributeName="cy" values="20;40;65;40;20" dur="2.6s" repeatCount="indefinite" />
                </circle>
              </svg>
            </div>
          )}
          {isRedis(p.name) && (
            <div class="sim-visual" data-sim="redis">
              <svg width="260" height="90" viewBox="0 0 260 90">
                <line class="sim-link" x1="35" y1="22" x2="105" y2="22" />
                <line class="sim-link" x1="105" y1="22" x2="160" y2="22" />
                <line class="sim-link" x1="160" y1="22" x2="225" y2="22" />
                <line class="sim-link" x1="160" y1="22" x2="160" y2="64" />
                <line class="sim-link" x1="160" y1="64" x2="225" y2="64" />

                <circle class="sim-node" cx="35" cy="22" r="9" />
                <circle class="sim-node" cx="105" cy="22" r="9" />
                <circle class="sim-node" cx="160" cy="22" r="9" />
                <circle class="sim-node" cx="225" cy="22" r="9" />
                <circle class="sim-node" cx="160" cy="64" r="9" />
                <circle class="sim-node" cx="225" cy="64" r="9" />

                <circle class="sim-pulse" cx="35" cy="22" r="3">
                  <animate attributeName="cx" values="35;105;160;225;160;225;160;105;35" dur="3.4s" repeatCount="indefinite" />
                  <animate attributeName="cy" values="22;22;22;22;22;64;64;22;22" dur="3.4s" repeatCount="indefinite" />
                </circle>
              </svg>
            </div>
          )}
        </div>
      ))}
    </section>

    <section id="teaching" class="section-block" data-label={profile.labels.headings.teaching}>
      <h2>{profile.labels.headings.teaching}</h2>
      {profile.teaching.map((t) => (
        <div style="margin-bottom: 2rem" class="project-card">
          <h3>{t.title}</h3>
          <div class="tech-meta">{t.skills}</div>
          <ul>
            {t.bullets.map((b) => <li>{b}</li>)}
          </ul>
        </div>
      ))}
    </section>

      <section id="skills" class="section-block" data-label={profile.labels.headings.skills}>
        <h2>{profile.labels.headings.skills}</h2>
        {profile.skills.map((s) => (
          <div class="meta-card">
            <h3>{s.category}</h3>
            <div class="tech-meta skills-line">{s.items.join(" ¬∑ ")}</div>
          </div>
        ))}
    </section>

    <section id="reading" class="section-block" data-label={profile.labels.headings.reading}>
      <h2>{profile.labels.headings.reading}</h2>
      <p>{profile.reading.description}</p>
        <div class="reading-inline">
          {profile.reading.items.map((item) => (
            <div class="reading-row">
              <span class="author">{item.author}</span>
              <span class="reading-quote">"{item.quote}"</span>
            </div>
          ))}
        </div>
      </section>
      <section id="connect" class="section-block" data-label={profile.labels.headings.connect}>
        <h2>{profile.labels.headings.connect}</h2>
        <p class="connect-text">
          Reach me at <a href="mailto:riadmukh@gmail.com" target="_blank" rel="noopener">riadmukh@gmail.com</a> or
          <a href="tel:+994508998676" target="_blank" rel="noopener"> +994 50 899 8676</a>
        </p>
      </section>
  </main>

  <script>
// @ts-nocheck
    const i18nEl = document.getElementById("i18n-data");
    const I18N = i18nEl ? JSON.parse(i18nEl.textContent || "{}") : {};
    const languageLabels = {
      en: "English",
      ru: "–†—É—Å—Å–∫–∏–π",
      az: "Az…ôrbaycanca",
      es: "Espa√±ol",
    };

    const openFromHash = () => {
      const id = window.location.hash.replace("#", "");
      if (!id) return;
      const section = document.getElementById(id);
      if (!section) return;
      section.scrollIntoView({ behavior: "smooth", block: "start" });
    };

    window.addEventListener("hashchange", openFromHash);
    window.addEventListener("load", openFromHash);

    /** @type {HTMLElement[]} */
    const sections = Array.from(document.querySelectorAll("section[id]"));
    const navLinks = Array.from(document.querySelectorAll(".side-nav a"));
    const mobileCurrent = document.querySelector(".mobile-current");

    const setActiveLink = () => {
      const scrollPos = window.scrollY + 120;
      let current = sections[0];
      sections.forEach((section) => {
        if (section.offsetTop <= scrollPos) current = section;
      });
      if (window.scrollY + window.innerHeight >= document.body.scrollHeight - 4) {
        current = sections[sections.length - 1];
      }
      navLinks.forEach((link) => link.classList.remove("active"));
      const active = navLinks.find((link) => link.getAttribute("href") === `#${current.id}`);
      active?.classList.add("active");
      if (mobileCurrent) {
        const label = active?.textContent ?? current.getAttribute("data-label") ?? current.id;
        mobileCurrent.textContent = label;
        mobileCurrent.classList.add("active");
      }
    };

    const updateProgress = () => {
      const progress = document.getElementById("scroll-progress");
      if (!progress) return;
      const docHeight = document.body.scrollHeight - window.innerHeight;
      const percent = docHeight > 0 ? (window.scrollY / docHeight) * 100 : 0;
      progress.style.height = `${percent}%`;
    };

    const updateNavBlur = () => {
      const nav = document.querySelector(".side-nav");
      const links = document.querySelector(".side-links");
      if (!nav && !links) return;
      const shouldBlur = window.scrollY > 40;
      nav?.classList.toggle("blurred", shouldBlur);
      links?.classList.toggle("blurred", shouldBlur);
    };

    window.addEventListener("scroll", () => {
      setActiveLink();
      updateProgress();
      updateNavBlur();
    });
    window.addEventListener("load", () => {
      setActiveLink();
      updateProgress();
      updateNavBlur();
    });

    document.querySelectorAll(".simulate-btn").forEach((btn) => {
      btn.addEventListener("click", () => {
        const card = btn.closest(".project-card");
        const sim = card?.querySelector(".sim-visual");
        sim?.classList.toggle("active");
      });
    });

    const hamburger = document.querySelector(".hamburger");
    const mobileMenu = document.querySelector(".mobile-menu");
    hamburger?.addEventListener("click", () => {
      mobileMenu?.classList.toggle("open");
      mobileMenu?.setAttribute(
        "aria-hidden",
        mobileMenu.classList.contains("open") ? "false" : "true"
      );
    });

    mobileMenu?.querySelectorAll("a").forEach((link) => {
      link.addEventListener("click", () => {
        mobileMenu.classList.remove("open");
        mobileMenu.setAttribute("aria-hidden", "true");
      });
    });

    // Reading section effects removed

    const langToggle = document.getElementById("lang-toggle");
    const langMenu = document.getElementById("lang-menu");
    const langCurrent = document.getElementById("lang-current");

    const buildExperience = (data) => {
      return `
        <h2>${data.labels.headings.experience}</h2>
        ${data.experience
          .map(
            (exp) => `
              <div class="project-card">
                <h3 class="job-title">${exp.role}</h3>
                <div class="experience-stack">
                  <span class="company-name">${exp.org}</span>
                  <small class="exp-meta">${exp.period}</small>
                  <small class="exp-meta">${exp.location}</small>
                </div>
                <ul>
                  ${exp.bullets.map((b) => `<li>${b}</li>`).join("")}
                </ul>
              </div>
            `
          )
          .join("")}
      `;
    };

    const hasSimulationFor = (name) =>
      name.includes("RAFT") ||
      name.includes("Raft") ||
      name.includes("Hash Table") ||
      name.includes("Distributed") ||
      name.includes("Kademlia") ||
      name.includes("Redis");
    const isRaftProject = (name) => name.includes("RAFT") || name.includes("Raft");
    const isKademliaProject = (name) =>
      name.includes("Hash Table") || name.includes("Distributed") || name.includes("Kademlia");
    const isRedisProject = (name) => name.includes("Redis");

    const buildProjectActions = (p) => {
      const actions = [];
      if (p.links?.github) {
        actions.push(`<a class="project-link" href="${p.links.github}" target="_blank" rel="noopener">${currentProfile.labels.links.github}</a>`);
      }
      if (hasSimulationFor(p.name)) {
        actions.push(`<button class="simulate-btn" type="button">Simulate</button>`);
      }
      return actions.join("");
    };

    const buildProjectSim = (p) => {
      if (isRaftProject(p.name)) {
        return `
          <div class="sim-visual" data-sim="raft">
            <svg width="260" height="80" viewBox="0 0 260 80">
              <line class="sim-link" x1="30" y1="40" x2="130" y2="15" />
              <line class="sim-link" x1="30" y1="40" x2="130" y2="65" />
              <line class="sim-link" x1="230" y1="40" x2="130" y2="15" />
              <line class="sim-link" x1="230" y1="40" x2="130" y2="65" />
              <circle class="sim-node" cx="30" cy="40" r="10" />
              <circle class="sim-node" cx="130" cy="15" r="10" />
              <circle class="sim-node" cx="130" cy="65" r="10" />
              <circle class="sim-node" cx="230" cy="40" r="10" />
              <circle class="sim-pulse" cx="30" cy="40" r="3">
                <animate attributeName="cx" values="30;130;230;130;30" dur="3s" repeatCount="indefinite" />
                <animate attributeName="cy" values="40;15;40;65;40" dur="3s" repeatCount="indefinite" />
              </circle>
            </svg>
          </div>
        `;
      }
      if (isKademliaProject(p.name)) {
        return `
          <div class="sim-visual" data-sim="kademlia">
            <svg width="260" height="80" viewBox="0 0 260 80">
              <line class="sim-link" x1="40" y1="20" x2="120" y2="40" />
              <line class="sim-link" x1="120" y1="40" x2="200" y2="20" />
              <line class="sim-link" x1="120" y1="40" x2="200" y2="65" />
              <circle class="sim-node" cx="40" cy="20" r="10" />
              <circle class="sim-node" cx="120" cy="40" r="10" />
              <circle class="sim-node" cx="200" cy="20" r="10" />
              <circle class="sim-node" cx="200" cy="65" r="10" />
              <circle class="sim-pulse" cx="40" cy="20" r="3">
                <animate attributeName="cx" values="40;120;200;120;40" dur="2.6s" repeatCount="indefinite" />
                <animate attributeName="cy" values="20;40;65;40;20" dur="2.6s" repeatCount="indefinite" />
              </circle>
            </svg>
          </div>
        `;
      }
      if (isRedisProject(p.name)) {
        return `
          <div class="sim-visual" data-sim="redis">
            <svg width="260" height="90" viewBox="0 0 260 90">
              <line class="sim-link" x1="35" y1="22" x2="105" y2="22" />
              <line class="sim-link" x1="105" y1="22" x2="160" y2="22" />
              <line class="sim-link" x1="160" y1="22" x2="225" y2="22" />
              <line class="sim-link" x1="160" y1="22" x2="160" y2="64" />
              <line class="sim-link" x1="160" y1="64" x2="225" y2="64" />

              <circle class="sim-node" cx="35" cy="22" r="9" />
              <circle class="sim-node" cx="105" cy="22" r="9" />
              <circle class="sim-node" cx="160" cy="22" r="9" />
              <circle class="sim-node" cx="225" cy="22" r="9" />
              <circle class="sim-node" cx="160" cy="64" r="9" />
              <circle class="sim-node" cx="225" cy="64" r="9" />

              <circle class="sim-pulse" cx="35" cy="22" r="3">
                <animate attributeName="cx" values="35;105;160;225;160;225;160;105;35" dur="3.4s" repeatCount="indefinite" />
                <animate attributeName="cy" values="22;22;22;22;22;64;64;22;22" dur="3.4s" repeatCount="indefinite" />
              </circle>
            </svg>
          </div>
        `;
      }
      return "";
    };

    let currentProfile = I18N.en;

    const buildProjects = (data) => {
      currentProfile = data;
      return `
        <h2>${data.labels.headings.projects}</h2>
        ${data.projects
          .map(
            (p) => `
              <div class="project-card">
                <div class="project-header">
                  <div>
                    <h3>${p.name}</h3>
                    <div class="project-tech">${p.tech.join(" ¬∑ ")}</div>
                  </div>
                  <div class="project-actions">
                    ${buildProjectActions(p)}
                  </div>
                </div>
                ${p.impact ? `<div class="project-impact"><strong>Impact:</strong> ${p.impact.replace(/^(?:Impact:\s*)+/i, "")}</div>` : ""}
                <ul class="project-bullets">
                  ${p.bullets.map((b) => `<li>${b}</li>`).join("")}
                </ul>
                ${buildProjectSim(p)}
              </div>
            `
          )
          .join("")}
      `;
    };

    const buildTeaching = (data) => {
      return `
        <h2>${data.labels.headings.teaching}</h2>
        ${data.teaching
          .map(
            (t) => `
              <div style="margin-bottom: 2rem" class="project-card">
                <h3>${t.title}</h3>
                <div class="tech-meta">${t.skills}</div>
                <ul>
                  ${t.bullets.map((b) => `<li>${b}</li>`).join("")}
                </ul>
              </div>
            `
          )
          .join("")}
      `;
    };

    const buildEducation = (data) => {
      return `
        <h2>${data.labels.headings.education}</h2>
        <div class="meta-card">
          <h3>${data.education.title}</h3>
          <div class="tech-meta">${data.education.meta}</div>
          <ul>
            ${data.education.bullets.map((b) => `<li>${b}</li>`).join("")}
          </ul>
        </div>
      `;
    };

    const buildSkills = (data) => {
      return `
        <h2>${data.labels.headings.skills}</h2>
        ${data.skills
          .map(
            (s) => `
              <div class="meta-card">
                <h3>${s.category}</h3>
                <div class="tech-meta skills-line">${s.items.join(" ¬∑ ")}</div>
              </div>
            `
          )
          .join("")}
      `;
    };

    const buildReading = (data) => {
      return `
        <h2>${data.labels.headings.reading}</h2>
        <p>${data.reading.description}</p>
        <div class="reading-inline">
          ${data.reading.items
            .map(
              (item) => `
                <div class="reading-row">
                  <span class="author">${item.author}</span>
                  <span class="reading-quote">"${item.quote}"</span>
                </div>
              `
            )
            .join("")}
        </div>
      `;
    };

    const buildConnect = (data) => {
      const template = data.labels.connectTemplate || "Reach me at {email} or {phone}";
      const html = template
        .replace("{email}", `<a href="mailto:riadmukh@gmail.com" target="_blank" rel="noopener">riadmukh@gmail.com</a>`)
        .replace("{phone}", `<a href="tel:+994508998676" target="_blank" rel="noopener"> +994 50 899 8676</a>`);
      return `
        <h2>${data.labels.headings.connect}</h2>
        <p class="connect-text">${html}</p>
      `;
    };

    const setIntroName = (name) => {
      const introName = document.querySelector(".intro-name");
      if (!introName) return;
      introName.setAttribute("aria-label", name);
      introName.innerHTML = "";
      Array.from(name).forEach((char, idx) => {
        const span = document.createElement("span");
        span.textContent = char === " " ? "\u00A0" : char;
        span.style.animationDelay = `${(0.05 + idx * 0.08).toFixed(2)}s`;
        introName.appendChild(span);
      });
    };

    const applyLanguage = (lang) => {
      const data = I18N[lang] || I18N.en;
      currentProfile = data;
      document.documentElement.lang = lang;
      if (langCurrent) langCurrent.textContent = languageLabels[lang] || "English";

      const heroTitle = document.querySelector("main section h1");
      const heroLinks = document.querySelector(".hero-links");
      const heroCta = document.querySelector(".hero-cta .cta-btn");
      const heroTaglines = document.querySelectorAll(".hero-tagline");
      if (heroTitle) heroTitle.textContent = data.hero.name;
      if (heroTaglines.length) {
        const parts = data.hero.tagline.split(". ");
        const primary = parts[0]?.trim() ?? "";
        const secondary = parts.slice(1).join(". ").trim();
        heroTaglines[0].textContent = `${primary}${primary.endsWith(".") ? "" : "."}`;
        if (heroTaglines[1]) {
          heroTaglines[1].textContent = secondary;
        }
      }
      if (heroLinks) {
        const links = heroLinks.querySelectorAll("a");
        if (links[0]) {
          links[0].textContent = data.labels.links.resume;
          links[0].setAttribute("href", data.links.resume);
        }
        if (links[1]) {
          links[1].textContent = data.labels.links.linkedin;
          links[1].setAttribute("href", data.links.linkedin);
        }
        if (links[2]) {
          links[2].textContent = data.labels.links.github;
          links[2].setAttribute("href", data.links.github);
        }
      }
      if (heroCta) {
        heroCta.setAttribute("href", data.links.resume);
        heroCta.innerHTML = `<svg class="cta-icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 4v10m0 0l-4-4m4 4l4-4M5 20h14" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"></path></svg>${data.labels.links.resume}`;
      }

      const introLead = document.querySelector(".intro-phrase .lead");
      if (introLead) {
        introLead.textContent = data.labels.introLead ?? "";
      }
      setIntroName(data.hero.name);

      const sideLinks = document.querySelector(".side-links");
      if (sideLinks) {
        const links = sideLinks.querySelectorAll("a");
        if (links[0]) links[0].textContent = data.labels.links.resume;
        if (links[1]) links[1].textContent = data.labels.links.linkedin;
        if (links[2]) links[2].textContent = data.labels.links.github;
      }

      const sideNav = document.querySelectorAll(".side-nav a");
      const mobileNav = document.querySelectorAll(".mobile-menu a");
      const labels = [
        data.labels.nav.education,
        data.labels.nav.experience,
        data.labels.nav.projects,
        data.labels.nav.teaching,
        data.labels.nav.skills,
        data.labels.nav.reading,
        data.labels.nav.connect,
      ];
      sideNav.forEach((link, idx) => {
        if (labels[idx]) link.textContent = labels[idx];
      });
      mobileNav.forEach((link, idx) => {
        if (labels[idx]) link.textContent = labels[idx];
      });

      const expSection = document.getElementById("experience");
      const projSection = document.getElementById("projects");
      const teachSection = document.getElementById("teaching");
      const eduSection = document.getElementById("education");
      const skillsSection = document.getElementById("skills");
      const readSection = document.getElementById("reading");
      const connectSection = document.getElementById("connect");

      if (expSection) expSection.innerHTML = buildExperience(data);
      if (projSection) projSection.innerHTML = buildProjects(data);
      if (teachSection) teachSection.innerHTML = buildTeaching(data);
      if (eduSection) eduSection.innerHTML = buildEducation(data);
      if (skillsSection) skillsSection.innerHTML = buildSkills(data);
      if (readSection) readSection.innerHTML = buildReading(data);
      if (connectSection) connectSection.innerHTML = buildConnect(data);

      expSection?.setAttribute("data-label", data.labels.headings.experience);
      projSection?.setAttribute("data-label", data.labels.headings.projects);
      teachSection?.setAttribute("data-label", data.labels.headings.teaching);
      eduSection?.setAttribute("data-label", data.labels.headings.education);
      skillsSection?.setAttribute("data-label", data.labels.headings.skills);
      readSection?.setAttribute("data-label", data.labels.headings.reading);
      connectSection?.setAttribute("data-label", data.labels.headings.connect);

      document.querySelectorAll(".simulate-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          const card = btn.closest(".project-card");
          const sim = card?.querySelector(".sim-visual");
          sim?.classList.toggle("active");
        });
      });

      setActiveLink();
    };

    const langWrapper = document.querySelector(".lang-switcher");
    langToggle?.addEventListener("click", () => {
      const isOpen = langMenu?.classList.contains("open");
      langMenu?.classList.toggle("open", !isOpen);
      langWrapper?.classList.toggle("open", !isOpen);
      langToggle?.setAttribute("aria-expanded", String(!isOpen));
    });

    langMenu?.querySelectorAll("button").forEach((btn) => {
      btn.addEventListener("click", () => {
        const lang = btn.getAttribute("data-lang") || "en";
        const current = document.documentElement.lang || "en";
        if (lang === current) {
          langMenu.classList.remove("open");
          langWrapper?.classList.remove("open");
          langToggle?.setAttribute("aria-expanded", "false");
          return;
        }
        localStorage.setItem("portfolio-lang", lang);
        langMenu.classList.remove("open");
        langWrapper?.classList.remove("open");
        langToggle?.setAttribute("aria-expanded", "false");
        window.location.reload();
      });
    });

    document.addEventListener("click", (event) => {
      if (!langMenu || !langToggle) return;
      const target = event.target;
      if (target instanceof Node && (langMenu.contains(target) || langToggle.contains(target))) return;
      langMenu.classList.remove("open");
      langWrapper?.classList.remove("open");
      langToggle.setAttribute("aria-expanded", "false");
    });

    const savedLang = localStorage.getItem("portfolio-lang") || "en";
    applyLanguage(savedLang);

  </script>
</BaseLayout>
